// src/pages/customincome.test.tsx
import React from "react";
import { render, screen, fireEvent } from "@testing-library/react";
import { MemoryRouter } from "react-router-dom";
import CustomIncome from "./customincome";

// mock useNavigate
const mockNavigate = vi.fn();
vi.mock("react-router-dom", async () => {
  const actual: any = await vi.importActual("react-router-dom");
  return {
    ...actual,
    useNavigate: () => mockNavigate,
  };
});

// mock alert
beforeEach(() => {
  vi.spyOn(window, "alert").mockImplementation(() => {});
  mockNavigate.mockReset();
});
afterEach(() => {
  vi.restoreAllMocks();
});

function renderWithRouter(ui: React.ReactNode) {
  return render(<MemoryRouter>{ui}</MemoryRouter>);
}

describe("CustomIncome Page", () => {
  it("à¹à¸ªà¸”à¸‡à¸«à¸±à¸§à¸‚à¹‰à¸­à¹à¸¥à¸° input", () => {
    renderWithRouter(<CustomIncome />);
    expect(screen.getByText("Custom Income")).toBeInTheDocument();
    expect(
      screen.getByPlaceholderText(/à¸„à¹‰à¸™à¸«à¸²à¹„à¸­à¸„à¸­à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰/i)
    ).toBeInTheDocument();
    expect(screen.getByPlaceholderText("à¸Šà¸·à¹ˆà¸­à¸«à¸¡à¸§à¸”à¸£à¸²à¸¢à¹„à¸”à¹‰")).toBeInTheDocument();
  });

  it("à¸à¸£à¸­à¸‡à¸”à¹‰à¸§à¸¢ search", () => {
    renderWithRouter(<CustomIncome />);
    const input = screen.getByPlaceholderText(/à¸„à¹‰à¸™à¸«à¸²à¹„à¸­à¸„à¸­à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰/i);
    fireEvent.change(input, { target: { value: "à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™" } });
    expect(screen.getByText("à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™ & à¸‡à¸²à¸™à¸›à¸£à¸°à¸ˆà¸³")).toBeInTheDocument();
    expect(screen.getByTitle("à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™")).toBeInTheDocument();
  });

  it("à¹€à¸¥à¸·à¸­à¸ icon à¹à¸¥à¸°à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­à¹„à¸”à¹‰", () => {
    renderWithRouter(<CustomIncome />);
    fireEvent.change(screen.getByPlaceholderText(/à¸„à¹‰à¸™à¸«à¸²à¹„à¸­à¸„à¸­à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰/i), {
      target: { value: "à¸Ÿà¸£à¸µà¹à¸¥à¸™à¸‹à¹Œ" },
    });
    const chip = screen.getByTitle("à¸Ÿà¸£à¸µà¹à¸¥à¸™à¸‹à¹Œ");
    fireEvent.click(chip);
    fireEvent.change(screen.getByPlaceholderText("à¸Šà¸·à¹ˆà¸­à¸«à¸¡à¸§à¸”à¸£à¸²à¸¢à¹„à¸”à¹‰"), {
      target: { value: "à¸£à¸²à¸¢à¹„à¸”à¹‰à¹€à¸ªà¸£à¸´à¸¡" },
    });
    expect(screen.getByDisplayValue("à¸£à¸²à¸¢à¹„à¸”à¹‰à¹€à¸ªà¸£à¸´à¸¡")).toBeInTheDocument();
  });

  it("alert à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸¥à¸·à¸­à¸ icon à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­", () => {
    renderWithRouter(<CustomIncome />);
    fireEvent.click(screen.getByRole("button", { name: "à¸¢à¸·à¸™à¸¢à¸±à¸™" }));
    expect(window.alert).toHaveBeenCalledWith("à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¹„à¸­à¸„à¸­à¸™à¹à¸¥à¸°à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­");
  });

  it("navigate à¹„à¸› /income à¸–à¹‰à¸²à¸à¸£à¸­à¸à¸„à¸£à¸š", () => {
    renderWithRouter(<CustomIncome />);
    // à¹€à¸¥à¸·à¸­à¸ icon
    fireEvent.change(screen.getByPlaceholderText(/à¸„à¹‰à¸™à¸«à¸²à¹„à¸­à¸„à¸­à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰/i), {
      target: { value: "à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™" },
    });
    fireEvent.click(screen.getByTitle("à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™"));

    // à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­
    fireEvent.change(screen.getByPlaceholderText("à¸Šà¸·à¹ˆà¸­à¸«à¸¡à¸§à¸”à¸£à¸²à¸¢à¹„à¸”à¹‰"), {
      target: { value: "à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™à¸«à¸¥à¸±à¸" },
    });

    fireEvent.click(screen.getByRole("button", { name: "à¸¢à¸·à¸™à¸¢à¸±à¸™" }));

    expect(mockNavigate).toHaveBeenCalledWith("/income", {
      state: {
        customIncome: {
          label: "à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™à¸«à¸¥à¸±à¸",
          icon: "Briefcase",
        },
      },
      replace: true,
    });
  });
});



